
<!DOCTYPE html>

<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>StudyMate - Study Room</title>
  <link rel="stylesheet" th:href="@{/css/common-styles.css}"/>
  <link rel="stylesheet" th:href="@{/css/studyroom-styles.css}"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div class="container">
  <input name="userId" th:value="${#authentication.principal.id}" type="hidden"/>
  <div class="studyroom-header">
    <div class="header-top">
      <h1 class="group-title" th:text="${group.groupName}">스터디룸</h1>
      <!-- 리더인 경우 -->
      <div class="settings-area" th:if="${group.memberRole == 'LEADER'}">
        <button class="settings-btn" onclick="openSettingsModal()">
          <i class="fas fa-cog"></i> 설정
        </button>
      </div>
      <!-- 일반 멤버인 경우 -->
      <div class="settings-area" th:if="${group.memberRole == 'MEMBER'}">
        <button class="leave-btn" onclick="confirmLeave()">
          <i class="fas fa-sign-out-alt"></i> 나가기
        </button>
      </div>
    </div>
    <div class="study-info">
      <span class="status" th:text="${group.status}">RECRUITING</span>
      <span class="members" th:text="|참여 인원: ${group.currentMembers} / ${group.maxMembers}|">
                참여 인원: 1/5
            </span>
      <span class="subject" th:text="${group.subjectName}">과목명</span>
    </div>
  </div>
  <!-- 스트리밍 섹션 -->
  <div class="streaming-section">
    <div class="video-container">
      <div class="main-video">
        <video autoplay="" id="localVideo" muted="" playsinline=""></video>
      </div>
      <div class="video-controls">
        <button id="muteButton"><i class="fas fa-microphone"></i></button>
        <button id="videoButton"><i class="fas fa-video"></i></button>
        <button id="screenShareButton"><i class="fas fa-desktop"></i></button>
      </div>
    </div>
    <div class="participants-videos">
      <!-- 참가자 비디오들이 동적으로 추가될 공간 -->
    </div>
  </div>
  <div class="studyroom-content">
    <div class="content-wrapper">
      <div class="content-grid">
        <div class="left-section">
          <div class="content-box">
            <h2>질문 게시판</h2>
            <!-- 선택된 게시글의 상세 내용을 보여주는 영역 -->
            <div class="selected-post" id="selectedPost" style="display: none;">
              <div class="post-header">
                <button class="back-btn" onclick="hideSelectedPost()">
                  <i class="fas fa-arrow-left"></i>
                </button>
                <h3 class="selected-title"></h3>
                <div class="post-actions">
                  <span class="selected-author"></span>
                  <div class="post-buttons">
                    <button class="edit-btn" onclick="editPost()" style="display: none;">
                      <i class="fas fa-edit"></i> 수정
                    </button>
                    <button class="delete-btn" onclick="deletePost()" style="display: none;">
                      <i class="fas fa-trash-alt"></i> 삭제
                    </button>
                  </div>
                </div>
              </div>
              <div class="post-content"></div>
              <div class="post-comments">
                <h4>댓글</h4>
                <div class="comments-list"></div>
                <div class="comment-form">
                  <textarea id="commentText" placeholder="댓글을 입력하세요..."></textarea>
                  <button onclick="addComment()">댓글 작성</button>
                </div>
              </div>
            </div>
            <!-- 게시글 목록을 보여주는 영역 -->
            <div class="post-list">
              <!-- 게시글 목록이 동적으로 로드됩니다 -->
            </div>
            <button class="action-btn" onclick="openQuestionModal()">질문하기</button>
          </div>
        </div>
        <div class="right-section">
          <div class="content-box">
            <h2>학습 자료실</h2>
            <div class="material-list">
              <!-- 자료 목록이 동적으로 로드됩니다 -->
            </div>
            <button class="action-btn" onclick="openUploadModal()">자료 업로드</button>
          </div>
          <div class="content-box">
            <h2>학습 일정</h2>
            <div class="schedule-list">
              <!-- 일정이 동적으로 로드됩니다 -->
            </div>
            <button class="action-btn" onclick="openScheduleModal()">일정 추가</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 자료 업로드 모달 -->
<div class="modal" id="uploadModal">
  <div class="modal-content">
    <span class="close" onclick="closeUploadModal()">×</span>
    <h2 class="modal-title">자료 업로드</h2>
    <form id="uploadForm">
      <div class="form-group">
        <label for="fileTitle">자료 제목</label>
        <input id="fileTitle" name="title" required="" type="text"/>
      </div>
      <div class="form-group">
        <label for="fileDescription">설명</label>
        <textarea id="fileDescription" name="description"></textarea>
      </div>
      <div class="form-group">
        <label for="fileUpload">파일 선택</label>
        <input id="fileUpload" name="file" required="" type="file"/>
      </div>
      <div class="form-actions">
        <button class="submit-btn" type="submit">업로드</button>
        <button class="cancel-btn" onclick="closeUploadModal()" type="button">취소</button>
      </div>
    </form>
  </div>
</div>
<!-- 일정 추가/수정 모달 -->
<div class="modal" id="scheduleModal">
  <div class="modal-content">
    <span class="close" onclick="closeScheduleModal()">×</span>
    <h2 class="modal-title">일정 추가</h2>
    <form id="scheduleForm">
      <div class="form-group">
        <label for="scheduleTitle">일정 제목</label>
        <input id="scheduleTitle" name="title" required="" type="text"/>
      </div>
      <div class="form-group">
        <label for="scheduleDate">날짜</label>
        <input id="scheduleDate" name="date" required="" type="date"/>
      </div>
      <div class="form-group">
        <label for="scheduleTime">시간</label>
        <input id="scheduleTime" name="time" required="" type="time"/>
      </div>
      <div class="form-group">
        <label for="scheduleDescription">설명</label>
        <textarea id="scheduleDescription" name="description"></textarea>
      </div>
      <div class="form-actions">
        <button class="submit-btn" type="submit">저장</button>
        <button class="cancel-btn" onclick="closeScheduleModal()" type="button">취소</button>
      </div>
    </form>
  </div>
</div>
<!-- 질문하기 모달 -->
<div class="modal" id="questionModal">
  <div class="modal-content">
    <span class="close" onclick="closeQuestionModal()">×</span>
    <h2 class="modal-title">질문하기</h2>
    <form id="questionForm">
      <input id="boardId" name="boardId" type="hidden"/>
      <input id="studygroupId" name="studygroupId" th:value="${group.id}" type="hidden"/>
      <div class="form-group">
        <label for="title">제목</label>
        <input id="title" name="title" required="" type="text"/>
      </div>
      <div class="form-group">
        <label for="content">내용</label>
        <textarea id="content" name="content" required=""></textarea>
      </div>
      <div class="form-actions">
        <button class="submit-btn" type="submit">작성완료</button>
        <button class="cancel-btn" onclick="closeQuestionModal()" type="button">취소</button>
      </div>
    </form>
  </div>
</div>
<!-- 설정 모달 -->
<div class="modal" id="settingsModal">
  <div class="modal-content">
    <span class="close" onclick="closeSettingsModal()">×</span>
    <h2 class="modal-title">스터디 설정</h2>
    <form id="settingsForm"><input id="groupId" th:value="${group.id}" type="hidden"/>
      <div class="form-group">
        <label for="groupName">스터디 그룹명</label>
        <input id="groupName" name="groupName" required="" th:value="${group.groupName}" type="text"/>
      </div>
      <div class="form-group">
        <label for="maxMembers">최대 인원</label>
        <select id="maxMembers" name="maxMembers">
          <option value="2">2명</option>
          <option value="3">3명</option>
          <option value="4">4명</option>
          <option value="5">5명</option>
        </select>
      </div>
      <div class="form-actions">
        <button class="submit-btn" type="submit">저장</button>
        <button class="delete-btn" onclick="confirmDelete()" type="button">스터디 삭제</button>
        <button class="cancel-btn" onclick="closeSettingsModal()" type="button">취소</button>
      </div>
    </form>
  </div>
</div>
<!-- 나가기 확인 모달 -->
<div class="modal" id="leaveConfirmModal">
  <div class="modal-content">
    <h2 class="modal-title">스터디 탈퇴</h2>
    <p>정말로 스터디에서 탈퇴하시겠습니까?</p>
    <div class="modal-actions">
      <button class="submit-btn" onclick="leaveGroup()">확인</button>
      <button class="cancel-btn" onclick="closeLeaveConfirmModal()">취소</button>
    </div>
  </div>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
console.log("groupName =", groupName);
console.log("groupId =", groupId);
console.log("userId =", userId);
<script th:src="@{/js/utils.js}"></script>
<script th:src="@{/js/model-handlers.js}"></script>
<script th:src="@{/js/stream-handlers.js}"></script>
<script th:src="@{/js/post-handlers.js}"></script>
<script th:src="@{/js/comment-handlers.js}"></script>
<script th:src="@{/js/schedule-handlers.js}"></script>
<script th:src="@{/js/material-handlers.js}"></script>
<script th:src="@{/js/main.js}"></script>
<script>
  document.getElementById("settingsForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const groupName = document.getElementById("groupName").value.trim();
    const maxMembers = document.getElementById("maxMembers").value;
    const groupId = document.getElementById("groupId").value;
    const userId = document.querySelector("input[name='userId']").value;

    if (!groupName) {
      alert("스터디 그룹명을 입력하세요");
      return;
    }

    fetch(`/api/study-mate/studygroups/update?groupId=${groupId}&userId=${userId}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
      group_name: groupName,
      max_members: parseInt(maxMembers)
  })
    }).then(res => {
      if (res.ok) {
        alert("저장되었습니다.");
        location.reload();
      } else {
        alert("수정 실패");
      }
    });
  });
</script></body>
</html>
